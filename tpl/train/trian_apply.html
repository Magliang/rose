<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>培训课程</title>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <div class="trian_apply_box">
        <div class="lg_container clr">
            <div class="col-xs-12">
                <h1>认证培训报名表</h1>
            </div>
            <div class="apply_choose_box col-xs-12 clr">
                <div class="col-xs-12"><h4>请选择培训类型(多选)</h4></div>
                <div class="col-xs-12">
                    <div class="col-xs-12 col-md-6 apply_choose_list">
                        <div class="apply_choose_items on" data-course="c1">
                            <h2>零基础培训</h2>
                            <p>需了解掌握Rose产品及解决方案相关基础知识，<br>不参与认证考试</p>
                            <b></b>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6 apply_choose_list">
                        <div class="apply_choose_items" data-course="c2">
                            <h2>认证工程师培训</h2>
                            <p>对Rose产品及解决方案有一定基础需更深入熟悉，<br>希望获取Rose认证工程师</p>
                            <b></b>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 apply_choose_box">
                <div class="col-xs-12"><h4>请选择培训班号</h4></div>
                <ul class="choose_class_num col-xs-12 clr">
                    <li class="clr">
                        <div class="col-xs-12 col-md-6" >
                           <i class="checkbox_btn checked" data-classnum="0" id="1"></i><span class="t_id">17TEC018 Rose认证工程师培训</span>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <p><span class="plan_addres">成都</span>2017.05.10-2017.05.12<span class="rt"></span></p>
                        </div>
                    </li>
                    <li class="clr">
                        <div class="col-xs-12 col-md-6">
                            <i class="checkbox_btn" data-classnum="1"></i><span>17TEC018 Rose认证工程师培训</span>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <p><span class="plan_addres">成都</span>2017.05.10-2017.05.12<span class="rt"></span></p>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="col-xs-12 apply_form_box">
                <form  class="clr" id="applyForm">
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">免冠证件照:</div>
                            <input type="hidden" name="af_ch_ty" id="applySchool"/>
                            <input type="hidden" name="t_id" id="applyClass"/>
                            <input type="hidden" name="af_bare" id="applyPhoto"/>
                            <div class="col-xs-8">
                                <div class="head_por"></div>
                                <div class="head_upload_box">
                                    <span id="uploadimg_open">上传图片</span>
                                    <p>注&nbsp;:&nbsp;照片需为近期免冠照片，务必确保清晰</p>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">性别:</div>
                            <div class="col-xs-8">
                                <div class="radio_box">
                                    <b></b><span>先生</span>
                                    <input type="radio" id="genderM" name="af_sex" value="男">
                                </div>
                                <div class="radio_box ">
                                    <b></b><span>女士</span>
                                    <input type="radio" id="genderW" name="af_sex" value="女">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">姓名:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_name" id="applyName">
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">身份证号码:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_ID" id="applyCard">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">联系电话:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="tel" name="af_co_num" id="applyPhone">
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">电子邮箱:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="email" name="af_emai" id="applyEmail">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">单位名称:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_un_na" id="applyPhone">
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">职务:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_job" id="applyEmail">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">所在省市:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_prov" id="applyPhone">
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 apply_form_label">通讯地址:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" name="af_po_ad" id="applyEmail">
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 form_line_list form_eager_box">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 eager_label">是否代理商:</div>
                            <div class="col-xs-8">
                                <div class="radio_box">
                                    <b></b><span>是</span>
                                    <input type="radio" name="af_agen" id="eagerY" value="1">
                                </div>
                                <div class="radio_box">
                                    <b class="choice"></b><span>否</span>
                                    <input type="radio" name="af_agen" value="0" id="eagerN" checked>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12  form_eager_box" style="display: none;">
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 eager_label">代理商编号:</div>
                            <div class="col-xs-8 apply_form_input">
                                <!--<s type="text" name="applyPhone" id="applyPhone">-->
                                    <select name="aq_id" id="applyPhone" style="width: 413px;height: 45px;background: #fafafa;border: 1px solid #ddd">
                                        <option value="">1</option>
                                    </select>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="col-xs-4 eager_label">代理商名称:</div>
                            <div class="col-xs-8 apply_form_input">
                                <input type="text" id="applyEmail">
                            </div>
                        </div>
                    </div>

                </form>
                <div class="col-xs-12">
                    <div class="col-xs-12 col-md-6">
                        <div class="col-xs-4 text-right">
                            <button id="apply_submit">立即报名</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="upload_box">
        <div class="clr upload_centent ">
            <div class="upload_btn clr">
                <a href="javascript:void(0)" class="btn btn-primary" onclick="document.getElementById('upinput').click()">选择图片</a>
                <a href="javascript:void(0)" class="btn btn-danger rt" onclick="saveImage()">上传头像</a>
                <input type="file" id="upinput" size="10" style="visibility:hidden;" onchange="selectImage(this.files)">
            </div>
            <div id="wrapper" class="clr">
                <canvas id="cropper" class="lt"></canvas>
                <div id="preview_img" class="rt">
                    <canvas id="preview124" width="124" height="144"></canvas>
                </div>
            </div>
            <div class="alert alert-success">上传成功，点击阴影部分回到页面继续填写</div>
        </div>
    </div>
    <div id="container_ap">
        <table class="table table-bordered table-responsive">
            <thead>
            <tr>
                <th colspan="2">预览表单</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>培训类型</td>
                <td data-class="af_ch_ty">
                    xxx
                </td>
            </tr>
            <tr>
                <td>培训班号</td>
                <td data-class="t_id">xxx</td>
            </tr>
            <tr>
                <td>免冠照</td>
                <td>
                    <div style="width: 124px;height: 144px"class="head_por">

                    </div>
                </td>
            </tr>
            <tr>
                <td>性别</td>
                <td data-class="af_sex">xxx</td>
            </tr>
            <tr>
                <td>姓名</td>
                <td data-class="af_name">xxx</td>
            </tr>
            <tr>
                <td>身份证</td>
                <td data-class="af_ID">xxx</td>
            </tr>
            <tr>
                <td>联系电话</td>
                <td data-class="af_co_num">xxxx</td>
            </tr>
            <tr>
                <td>电子邮箱</td>
                <td data-class="af_emai">xxx</td>
            </tr>
            <tr>
                <td>单位名称</td>
                <td data-class="af_un_na">xxx</td>
            </tr>
            <tr>
                <td>职务</td>
                <td data-class="af_job">xxx</td>
            </tr>
            <tr>
                <td>所在省市</td>
                <td data-class="af_prov">xxx</td>
            </tr>
            <tr>
                <td>通讯地址</td>
                <td data-class="af_po_ad">yyy</td>
            </tr>
            <tr>
                <td>代理商编号</td>
                <td data-class="aq_id">yyy</td>
            </tr>
            <tr>
                <td>代理商名称</td>
                <td data-class="">yyy</td>
            </tr>
            </tbody>
        </table>
        <button class="btn-sm btn-danger" id="previewBtn">确定</button>
        <button class="btn-sm btn-info" id="previewClose">取消</button>
    </div>
    <script src="../../js/jquery-1.12.4.js"></script>
    <script src="../../js/uploadimg.js"></script>
    <script src="../../js/trian.js"></script>
    <script>
        $(document).ready(function(){
            //立即报名
            var submitData = {},cansubmit=false,inputName=["af_sex","af_name","af_ID","af_co_num","af_emai","af_un_na","af_job","af_prov","af_po_ad","aq_id"];
            getDataFromHtml();
            $("#apply_submit").on('click',function(){

                getDataFromHtml();
                formTest ();
                console.log("已执行");



                //提交form表单
//                var data=new FormData($("#applyForm")[0]);
                if(cansubmit){
                    //弹出预览表单确认框
                    $("#container_ap").css({display:"block"});
                    $("td[data-class='af_ch_ty']").html($(".on h2").html());
                    $("td[data-class='t_id']").html($(".t_id").html());
                    for(var i=0;i<inputName.length;i++){
                        changeInput(inputName[i]);
                    }

                }
            });
//          循环添加预览表单
            var changeInput=function(e){
                var inputVal=$("input[name='"+e+"']").val();
                $("td[data-class='"+e+"']").html(inputVal);
            };


//            预览确认后提交表单
            $("#previewBtn").on("click",function(){
                $.ajax({
                    type:"POST",
                    url:"http://172.16.1.49/index/partner/add",
                    data:$("#applyForm").serialize(),
                    dataType:"json",
                    success:function(){
                        alert("提交成功");
                    }
                });
            });
            $("#previewClose").on("click",function(){
               $("#container_ap").css({display:"none"})
            });
//            身份证,电话,邮箱验证
//            $("#applyPhone").focusout(function(){
//                var Id=$(this).val();
//                if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(Id))){
//                    $(this).one(function(){
//                        alert("您没有输入号码或号码位数不正确");
//
//                    })
//
//                }
//            })
//            $("#applyCard").focusout(function(){
//                var Id=$(this).val();
//                if(!(/\d{18}$/.test(Id))){
//                    alert("您没有输入或身份证号位数不正确")
//                }
//            })
//            $("#applyEmail").focusout(function(){
//                var Id=$(this).val();
//                if(!(/(\S)+[@]{1}(\S)+[.]{1}(\w)+/.test(Id))){
//                    alert("您没有输入或邮箱格式不正确")
//                }
//            })
            // 选择培训类型
            $('.apply_choose_items').on('click',function(){
                $(this).toggleClass('on');
            });
            //经销商是否显示
            $('.form_eager_box .radio_box b').on('click',function(){
                if($(this).next().text()=="是"){
                    $('.form_eager_box')[1].style.display="block";
                }
                else{
                   $('.form_eager_box')[1].style.display="none";
                }

            });
            $("#")
            //上传头像按钮的点击事件
            $('#uploadimg_open').unbind('submit');
            $('#uploadimg_open').on('click',function(e){
                // 调出上传模态框
                $('#upload_box').show();
            })
            $("#upload_box").on('click',function(e){
                    $(this).hide();
            })
            $("#upload_box .upload_centent").on('click',function(e){
                e.stopPropagation();
            });
            // 从页面中获取需要传入的参数
            function getDataFromHtml () {
                //培训类型
                submitData.trainsort = [];
                $(".apply_choose_items.on").each(function(){
                   submitData.trainsort.push($(this).attr("data-course"));
                });
                //班号
                submitData.classnum = $(".checkbox_btn.checked").attr("id");
                //form序列
                submitData.form = new FormData($("#applyForm")[0]);
//                input赋值
                $("#applySchool").val(submitData.trainsort);
                $("#applyClass").val(submitData.classnum);
            }
            //表单检验
            function formTest () {
                $(".apply_form_input input").each(function(){
                    if(!$(this).val() == ''){
                        cansubmit=true;
                        return;
                    }
                })
            }
        });
        //头像上传功能
        var cropper;

        function init()
        {
            //绑定
            cropper = new ImageCropper(400, 300, 124, 144);
            cropper.setCanvas("cropper");
            cropper.addPreview("preview124");
            //检测用户浏览器是否支持imagecropper插件
            if(!cropper.isAvaiable())
            {
                alert("Sorry, your browser doesn't support FileReader, please use Firefox3.6+ or Chrome10+ to run it.");
            }
        }
        init();//初始化
        // 打开本地文件
        function selectImage(fileList)
        {
            cropper.loadImage(fileList[0]);
        }
        //上传图片
        function saveImage()
        {
            //选个你需要的大小
            var imgData = cropper.getCroppedImageData(124, 144);
//            submitData.url=imgData;
            $("#applyPhoto").val(imgData);
            $(".head_por").css({background:"url("+imgData+")"});
            $("#upload_box").css({display:"none"});
        }
    </script>
</body>
</html>
